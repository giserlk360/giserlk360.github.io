import{g as ge,x as pe,c as Ce,E as be,f as y,_ as we,q as ye,h as Se,s as ze,d as $e}from"./index-8c328d50.js";import{R as Le}from"./resize-observer-a448391a.js";import{d as Ve,e as Be,p as Re,c as Z}from"./pick-e3f0369e.js";import{u as Ie}from"./use-cursor-9e99a648.js";import{d as Ne,t as Te,r as d,c as v,A as F,o as ke,O as _,a as M,b as S,h as z,j as O,n as Ee,E as A,i as P,k as j,f as ee,g as He,u as ae,l as xe}from"./index-147532fb.js";const Fe=["border-width","box-sizing","font-family","font-weight","font-size","font-variant","letter-spacing","line-height","padding-top","padding-bottom","padding-left","padding-right","text-indent","text-rendering","text-transform","white-space","overflow-wrap","width"],Me=e=>{const l={};return Fe.forEach(f=>{l[f]=e.getPropertyValue(f)}),l},Oe=Ne({name:"Textarea",components:{ResizeObserver:Le,IconHover:Ve,IconClose:Be},inheritAttrs:!1,props:{modelValue:String,defaultValue:{type:String,default:""},placeholder:String,disabled:{type:Boolean,default:!1},error:{type:Boolean,default:!1},maxLength:{type:[Number,Object],default:0},showWordLimit:{type:Boolean,default:!1},allowClear:{type:Boolean,default:!1},autoSize:{type:[Boolean,Object],default:!1},wordLength:{type:Function},wordSlice:{type:Function}},emits:{"update:modelValue":e=>!0,input:(e,l)=>!0,change:(e,l)=>!0,clear:e=>!0,focus:e=>!0,blur:e=>!0},setup(e,{emit:l,attrs:f}){const{disabled:W,error:U,modelValue:g}=Te(e),m=ge("textarea"),{mergedDisabled:c,mergedError:$,eventHandlers:o}=pe({disabled:W,error:U}),s=d(),q=d(),p=d(),G=d(),L=d(e.defaultValue),i=v(()=>{var a;return(a=g.value)!=null?a:L.value}),[le,te]=Ie(s);F(g,a=>{(Ce(a)||be(a))&&(L.value="")});const C=v(()=>y(e.maxLength)&&Boolean(e.maxLength.errorOnly)),u=v(()=>y(e.maxLength)?e.maxLength.length:e.maxLength),b=a=>{var t;return ye(e.wordLength)?e.wordLength(a):(t=a.length)!=null?t:0},J=v(()=>b(i.value)),oe=v(()=>$.value||Boolean(u.value&&C.value&&J.value>u.value)),h=d(!1),V=d(!1),ne=v(()=>e.allowClear&&!c.value&&i.value),B=d(!1),K=d(""),R=()=>{le(),_(()=>{s.value&&i.value!==s.value.value&&(s.value.value=i.value,te())})},w=(a,t=!0)=>{var n,r;u.value&&!C.value&&b(a)>u.value&&(a=(r=(n=e.wordSlice)==null?void 0:n.call(e,a,u.value))!=null?r:a.slice(0,u.value)),L.value=a,t&&l("update:modelValue",a),R()};let I=i.value;const Q=(a,t)=>{var n,r;a!==I&&(I=a,l("change",a,t),(r=(n=o.value)==null?void 0:n.onChange)==null||r.call(n,t))},re=a=>{var t,n;V.value=!0,I=i.value,l("focus",a),(n=(t=o.value)==null?void 0:t.onFocus)==null||n.call(t,a)},se=a=>{var t,n;V.value=!1,l("blur",a),(n=(t=o.value)==null?void 0:t.onBlur)==null||n.call(t,a),Q(i.value,a)},ue=a=>{var t,n;const{value:r}=a.target;if(a.type==="compositionend"){if(B.value=!1,K.value="",u.value&&!C.value&&i.value.length>=u.value&&b(r)>u.value){R();return}l("input",r,a),w(r),(n=(t=o.value)==null?void 0:t.onInput)==null||n.call(t,a)}else B.value=!0},ie=a=>{var t,n;const{value:r}=a.target;if(B.value)K.value=r;else{if(u.value&&!C.value&&i.value.length>=u.value&&b(r)>u.value&&a.inputType==="insertText"){R();return}l("input",r,a),w(r),(n=(t=o.value)==null?void 0:t.onInput)==null||n.call(t,a)}},de=a=>{w(""),Q("",a),l("clear",a)};F(g,a=>{a!==i.value&&w(a!=null?a:"",!1)});const ve=a=>Se(f,Z),fe=a=>Re(f,Z),me=v(()=>[`${m}-wrapper`,{[`${m}-focus`]:V.value,[`${m}-disabled`]:c.value,[`${m}-error`]:oe.value,[`${m}-scroll`]:h.value}]);let X;const N=d(0),T=d(0),k=v(()=>!y(e.autoSize)||!e.autoSize.minRows?0:e.autoSize.minRows*N.value+T.value),E=v(()=>!y(e.autoSize)||!e.autoSize.maxRows?0:e.autoSize.maxRows*N.value+T.value),H=()=>{const a=Me(X);N.value=Number.parseInt(a["line-height"]||0,10),T.value=Number.parseInt(a["border-width"]||0,10)*2+Number.parseInt(a["padding-top"]||0,10)+Number.parseInt(a["padding-bottom"]||0,10),G.value=a,_(()=>{var t;const n=(t=p.value)==null?void 0:t.offsetHeight;let r=n!=null?n:0,Y="hidden";k.value&&r<k.value&&(r=k.value),E.value&&r>E.value&&(r=E.value,Y="auto"),q.value={height:`${r}px`,resize:"none",overflow:Y}})};ke(()=>{s.value&&(X=window.getComputedStyle(s.value),e.autoSize&&H()),x()});const ce=()=>{e.autoSize&&p.value&&H(),x()},he=a=>{s.value&&a.target!==s.value&&(a.preventDefault(),s.value.focus())},x=()=>{s.value&&(s.value.scrollHeight>s.value.offsetHeight?h.value||(h.value=!0):h.value&&(h.value=!1))};return F(i,()=>{e.autoSize&&p.value&&H(),x()}),{prefixCls:m,wrapperCls:me,textareaRef:s,textareaStyle:q,mirrorRef:p,mirrorStyle:G,computedValue:i,showClearBtn:ne,valueLength:J,computedMaxLength:u,mergedDisabled:c,getWrapperAttrs:ve,getTextareaAttrs:fe,handleInput:ie,handleFocus:re,handleBlur:se,handleComposition:ue,handleClear:de,handleResize:ce,handleMousedown:he}},methods:{focus(){var e;(e=this.$refs.textareaRef)==null||e.focus()},blur(){var e;(e=this.$refs.textareaRef)==null||e.blur()}}}),Ae=["disabled","value","placeholder"];function Pe(e,l,f,W,U,g){const m=M("resize-observer"),c=M("icon-close"),$=M("icon-hover");return S(),z("div",ae(e.getWrapperAttrs(e.$attrs),{class:e.wrapperCls,onMousedown:l[7]||(l[7]=(...o)=>e.handleMousedown&&e.handleMousedown(...o))}),[e.autoSize?(S(),z("div",{key:0,ref:"mirrorRef",class:O(`${e.prefixCls}-mirror`),style:Ee(e.mirrorStyle)},A(`${e.computedValue}
`),7)):P("v-if",!0),j(m,{onResize:e.handleResize},{default:ee(()=>[He("textarea",ae({ref:"textareaRef"},e.getTextareaAttrs(e.$attrs),{disabled:e.mergedDisabled,class:e.prefixCls,style:e.textareaStyle,value:e.computedValue,placeholder:e.placeholder,onInput:l[0]||(l[0]=(...o)=>e.handleInput&&e.handleInput(...o)),onFocus:l[1]||(l[1]=(...o)=>e.handleFocus&&e.handleFocus(...o)),onBlur:l[2]||(l[2]=(...o)=>e.handleBlur&&e.handleBlur(...o)),onCompositionstart:l[3]||(l[3]=(...o)=>e.handleComposition&&e.handleComposition(...o)),onCompositionupdate:l[4]||(l[4]=(...o)=>e.handleComposition&&e.handleComposition(...o)),onCompositionend:l[5]||(l[5]=(...o)=>e.handleComposition&&e.handleComposition(...o))}),null,16,Ae)]),_:1},8,["onResize"]),xe(e.$slots,"suffix"),e.computedMaxLength&&e.showWordLimit?(S(),z("div",{key:1,class:O(`${e.prefixCls}-word-limit`)},A(e.valueLength)+"/"+A(e.computedMaxLength),3)):P("v-if",!0),e.showClearBtn?(S(),z("div",{key:2,class:O(`${e.prefixCls}-clear-btn`),onClick:l[6]||(l[6]=(...o)=>e.handleClear&&e.handleClear(...o))},[j($,null,{default:ee(()=>[j(c)]),_:1})],2)):P("v-if",!0)],16)}var D=we(Oe,[["render",Pe]]);const Ge=Object.assign(D,{install:(e,l)=>{ze(e,l);const f=$e(l);e.component(f+D.name,D)}});export{Ge as T};

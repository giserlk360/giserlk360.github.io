import{P as G,r as b,A as M,o as R,a as X,b as O,e as V,$ as D,h as T,g as C,f as v,k as m,K as _,a0 as Y,D as w,a1 as J,a2 as K,m as j,y as W,G as L,H as F}from"./index-bbce9413.js";import{_ as I}from"./_plugin-vue_export-helper-c4cb8a60.js";import{M as H}from"./index-ac16a1f8.js";import{B as A,v as Z}from"./index-0e4b31d4.js";import{F as q,a as Q}from"./index-11a606e1.js";import"./index-8896020a.js";import{I as ee}from"./index-24d3e248.js";import{I as k}from"./index-617968ed.js";import{S as te}from"./index-00b20d4a.js";import"./index-bdfc4cee.js";import{T as ne}from"./index-8a2f699c.js";import"./index-89b0e030.js";import{B as oe,C as se,r as ie,a as ae,u as re,l as le,M as de,o as ce,b as pe,c as ue,V as me,T as fe,X as he,F as ge,P as _e,S as ve,I as ye,d as Pe,e as Se}from"./Vector-dab2dab8.js";import{c as be}from"./proj-3c69de6c.js";import"./constant-82db06a1.js";import"./index-7cb8bd8a.js";import"./index-d8c131de.js";import"./omit-beff4be5.js";import"./index-d0abaf49.js";import"./get-value-by-path-81b19032.js";import"./index-3eff0a75.js";import"./index-e8a5f3e2.js";const x=G("svgmap",()=>{let y=b("./svg/320000.svg"),e=b({bounds:[[115.564327,29.942059],[122.821885,35.554538]],dimensions:[809,754],data:[{name:"\u5357\u4EAC",value:[118.7794,32.0395]},{name:"\u82CF\u5DDE",value:[120.5905,31.3094]},{name:"\u5357\u901A",value:[120.89,32.0049]}]}),t=b(!1);function n(s){y.value=s}function r(s){e.value=s}function o(s){e.value.dimensions=s}function i(s){t.value=s}return{svgUrl:y,updateSvgUrl:n,pointConfig:e,addPointShow:t,updatePointConfig:r,updateSvgDimensions:o,updateAddPointShow:i}});const Ce={__name:"EchartsSvg",setup(y){const e=x(),t=b(),n=b(),r=async(a,c)=>{try{const u=await fetch(c);if(u.status==200){const P=await u.text();return D(a,{svg:P}),!0}else H.error("\u65E0\u5730\u56FE\u8D44\u6E90\uFF01\uFF01\uFF01")}catch(u){return console.log(u),!1}},o=async()=>{const a=e.svgUrl;n.value=i(),await r(n.value.geo.map,a)&&d()},i=()=>({geo:{left:0,top:0,right:0,bottom:0,map:"svgMap",roam:!0,layoutCenter:["50%","50%"],layoutSize:"100%",itemStyle:{borderWidth:0,color:"transparent"},select:{label:{show:!0,color:"#fff",fontSize:12},itemStyle:{color:"#ffff33",borderColor:"#ebc11e",borderWidth:4}},label:{show:!1},emphasis:{focus:"none",itemStyle:{areaColor:"#2080D7",borderColor:"#2B91B7",borderWidth:2,opacity:1,shadowColor:"rgba(74, 188, 251, 0.4)",shadowBlur:3,shadowOffsetX:3,shadowOffsetY:5},label:{show:!1,color:"#fff",fontSize:12}},tooltip:{show:!0,padding:0,formatter:function(a){return a.name}}},tooltip:{show:!0},series:[{type:"scatter",coordinateSystem:"geo",geoIndex:0,data:[]}]}),s=()=>{var a;(a=t.value)==null||a.setOption(n.value,!0)},l=a=>{const c=e.pointConfig.bounds[0],u=e.pointConfig.bounds[1],P=e.pointConfig.dimensions[0],f=e.pointConfig.dimensions[1],S=P/(u[0]-c[0]),E=f/(u[1]-c[1]);return p(a,u,c,E,S)},p=(a,c,u,P,f)=>[Math.abs(a[0]-u[0])*f,Math.abs(a[1]-c[1])*P],d=()=>{const c=e.pointConfig.data.map(u=>({name:u.name,value:l(u.value),symbol:"image://imgs/point.png",symbolSize:[35,35]}));n.value.series[0].data=c,s()},h=a=>{const c=[a.event.offsetX,a.event.offsetY],u=t.value.convertFromPixel({geoIndex:0},c);console.log("\u{1F680} ~ clickMap ~ dataPoint:",u)};return M(()=>e.svgUrl,()=>{o()}),M(()=>e.pointConfig,()=>{d()},{immediate:!1,deep:!0}),R(()=>{o()}),(a,c)=>{const u=X("v-chart");return O(),V(u,{ref_key:"svgMapRef",ref:t,autoresize:"",class:"map-content",onClick:h},null,512)}}},Ee=I(Ce,[["__scopeId","data-v-eed71dd9"]]);const we={class:"tools"},Oe={__name:"Tools",setup(y){const e=x(),t=b(null),n=i=>{const s=i.target.files[0];if(!s)return;const l=new FileReader;l.onload=p=>{console.log("\u{1F680} ~ uploadFile ~ e:",p);const d=URL.createObjectURL(new Blob([p.target.result]));console.log("\u{1F680} ~ uploadFile ~ url:",d),e.updateSvgUrl(d),o(d),window.addEventListener("beforeunload",function(){URL.revokeObjectURL(d)})},l.readAsText(s)},r=()=>{t.value.click()},o=i=>{var s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=new XMLHttpRequest;l.open("GET",i,!0),l.onreadystatechange=function(){if(l.readyState==4&&l.status==200){s.innerHTML=l.responseText;var p=s.querySelector("svg"),d=p.getAttribute("width"),h=p.getAttribute("height"),a=parseFloat(d),c=parseFloat(h);e.updateSvgDimensions([a,c]),console.log(e.pointConfig),console.log("SVG \u5BBD\u5EA6: "+a),console.log("SVG \u9AD8\u5EA6: "+c)}},l.send()};return(i,s)=>(O(),T("div",we,[C("div",{class:"btn-group"},[C("div",{class:"btn",onClick:r},"\u4E0A\u4F20svg")]),C("input",{ref_key:"fileInput",ref:t,type:"file",accept:".svg",style:{display:"none"},onChange:n},null,544)]))}},Ie=I(Oe,[["__scopeId","data-v-bd826853"]]);const Me=y=>(J("data-v-ff7b08e5"),y=y(),K(),y),xe=Me(()=>C("div",{class:"title"},"\u7ECF\u7EAC\u5EA6\u6253\u70B9",-1)),Te={__name:"PointsInfo",setup(y){const e=x(),t={autorefresh:!0,smartIndent:!0,tabSize:4,mode:"application/json",theme:"dracula",matchBrackets:!0,lineWrapping:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],lint:!1,lineNumbers:!0,indentUnit:2,foldGutter:!0,styleActiveLine:!0},n=b({bounds:JSON.stringify(e.pointConfig.bounds),dimensions:JSON.stringify(e.pointConfig.dimensions),data:JSON.stringify(e.pointConfig.data,null,2)}),r=()=>{console.log(n);const i={...n.value};e.updatePointConfig({bounds:JSON.parse(i.bounds),dimensions:JSON.parse(i.dimensions),data:JSON.parse(i.data)})},o=()=>{e.updateAddPointShow(!0)};return M(()=>e.pointConfig,i=>{n.value.dimensions=JSON.stringify(i.dimensions),n.value.data=JSON.stringify(i.data,null,2)},{deep:!0}),(i,s)=>{const l=k,p=Q,d=A,h=q;return O(),V(h,{model:_(n),class:"formLayout"},{default:v(()=>[xe,m(p,{field:"bounds",label:"\u56DB\u81F3\u8303\u56F4"},{default:v(()=>[m(l,{modelValue:_(n).bounds,"onUpdate:modelValue":s[0]||(s[0]=a=>_(n).bounds=a),placeholder:"\u8BF7\u8F93\u5165\u56DB\u81F3\u8303\u56F4[[\u5DE6\u4E0B\u89D2\u7ECF\u7EAC\u5EA6], [\u53F3\u4E0A\u89D2\u7ECF\u7EAC\u5EA6]]"},null,8,["modelValue"])]),_:1}),m(p,{field:"dimensions",label:"svg\u5C3A\u5BF8"},{default:v(()=>[m(l,{modelValue:_(n).dimensions,"onUpdate:modelValue":s[1]||(s[1]=a=>_(n).dimensions=a),placeholder:"\u8BF7\u8F93\u5165svg\u5C3A\u5BF8[\u5BBD, \u9AD8]"},null,8,["modelValue"])]),_:1}),m(p,{field:"data",label:"\u70B9\u6570\u636E",style:{position:"relative"}},{default:v(()=>[m(_(Y),{value:_(n).data,"onUpdate:value":s[2]||(s[2]=a=>_(n).data=a),options:t,height:300},null,8,["value"]),m(d,{type:"primary",size:"mini",shape:"round",style:{position:"absolute",right:"25px",top:"10px"},onClick:o},{icon:v(()=>[m(_(ee))]),default:v(()=>[w("\u65B0\u589E\u70B9\u4F4D")]),_:1})]),_:1}),m(p,null,{default:v(()=>[m(d,{"html-type":"submit",onClick:r},{default:v(()=>[w("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},8,["model"])}}},Ne=I(Te,[["__scopeId","data-v-ff7b08e5"]]),g={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Le extends oe{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+se,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(g.ELEMENT,this.handleElementChanged),this.addChangeListener(g.MAP,this.handleMapChanged),this.addChangeListener(g.OFFSET,this.handleOffsetChanged),this.addChangeListener(g.POSITION,this.handlePositionChanged),this.addChangeListener(g.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(g.ELEMENT)}getId(){return this.id}getMap(){return this.get(g.MAP)||null}getOffset(){return this.get(g.OFFSET)}getPosition(){return this.get(g.POSITION)}getPositioning(){return this.get(g.POSITIONING)}handleElementChanged(){ie(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(ae(this.element),re(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=le(e,de.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(g.ELEMENT,e)}setMap(e){this.set(g.MAP,e)}setOffset(e){this.set(g.OFFSET,e)}setPosition(e){this.set(g.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(g.POSITION))return;const n=this.getRect(t.getTargetElement(),t.getSize()),r=this.getElement(),o=this.getRect(r,[ce(r),pe(r)]);e=e||{};const i=e.margin===void 0?20:e.margin;if(!be(n,o)){const s=o[0]-n[0],l=n[2]-o[2],p=o[1]-n[1],d=n[3]-o[3],h=[0,0];if(s<0?h[0]=s-i:l<0&&(h[0]=Math.abs(l)+i),p<0?h[1]=p-i:d<0&&(h[1]=Math.abs(d)+i),h[0]!==0||h[1]!==0){const a=t.getView().getCenterInternal(),c=t.getPixelFromCoordinateInternal(a);if(!c)return;const u=[c[0]+h[0],c[1]+h[1]],P=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(u),duration:P.duration,easing:P.easing})}}}getRect(e,t){const n=e.getBoundingClientRect(),r=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[r,o,r+t[0],o+t[1]]}setPositioning(e){this.set(g.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const n=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(n,r)}updateRenderedPosition(e,t){const n=this.element.style,r=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const i=Math.round(e[0]+r[0])+"px",s=Math.round(e[1]+r[1])+"px";let l="0%",p="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?l="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(l="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?p="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(p="-50%");const d=`translate(${l}, ${p}) translate(${i}, ${s})`;this.rendered.transform_!=d&&(this.rendered.transform_=d,n.transform=d)}getOptions(){return this.options}}const Fe=Le;const Re={class:"point-popover"},Ve={__name:"Map",setup(y){const e=x(),t=b(null),n=j({MapsViewOption:{center:[119.3633,33.0169],projection:"EPSG:4326",zoom:7,maxZoom:17,minZoom:1}});let r=b({pointName:"",pointCoord:[]}),o=b(!1),i=null,s=null,l=b(null);R(()=>{});const p=()=>{i=new ue({layers:[d("vec"),d("cva")],target:t.value,view:new me(n.MapsViewOption)}),i.on("click",function(f){r.value.pointCoord=f.coordinate,h(f.coordinate)})},d=f=>{let S=`http://t0.tianditu.gov.cn/${f}_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=${f}&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk=1d109683f4d84198e37a38c442d68311`;return new fe({title:"\u5730\u56FE\u74E6\u7247",source:new he({url:S})})},h=f=>{s&&i.removeLayer(s);const S=new ge({geometry:new _e(f),name:"point"});new ve({image:new ye({src:"./imgs/point.png",scale:.5})});const E=new Pe({features:[S]});s=new Se({source:E}),i.addLayer(s),a(f)},a=f=>{o.value=!0,r.value.pointName="";const S=new Fe({element:l.value,autoPan:!1,autoPanAnimation:{duration:250}});i.addOverlay(S),S.setPosition(f)},c=()=>{console.log("submit!",e.pointConfig.data),e.pointConfig.data.push({name:r.value.pointName,value:r.value.pointCoord}),e.addPointShow=!1,P()},u=()=>{o.value=!1};M(()=>e.addPointShow,f=>{f&&setTimeout(()=>{p()},500)},{immediate:!0});const P=()=>{i&&(i.setTarget(null),i=null)};return W(()=>{P()}),(f,S)=>{const E=ne,B=k,U=te,N=A,$=Z;return L((O(),T("div",{ref_key:"maps",ref:t,class:"maps-container"},[C("div",Re,[L(C("div",{ref_key:"popupRef",ref:l,class:"message-box"},[m(U,null,{default:v(()=>[m(E,{style:{width:"45px"}},{default:v(()=>[w("\u540D\u79F0\uFF1A")]),_:1}),m(B,{modelValue:_(r).pointName,"onUpdate:modelValue":S[0]||(S[0]=z=>_(r).pointName=z)},null,8,["modelValue"])]),_:1}),m($,{style:{position:"absolute",left:"60px",bottom:"10px"}},{default:v(()=>[m(N,{type:"primary",size:"mini",onClick:c,style:{"margin-right":"10px"}},{default:v(()=>[w("\u786E\u5B9A")]),_:1}),m(N,{type:"primary",size:"mini",onClick:u},{default:v(()=>[w("\u53D6\u6D88")]),_:1})]),_:1})],512),[[F,_(o)]])])],512)),[[F,_(e).addPointShow]])}}},Ae=I(Ve,[["__scopeId","data-v-9faa8b90"]]);const ke={class:"mapView w-full min-h-[calc(100vh-58px)]"},Be={__name:"index",setup(y){return(e,t)=>(O(),T("div",ke,[m(Ee),m(Ie),m(Ne),m(Ae)]))}},rt=I(Be,[["__scopeId","data-v-64400f16"]]);export{rt as default};
